<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Test JS">
<meta name="mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==">
<title>Test JavaScript iOS</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#667eea;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;margin:0}
.box{background:#fff;border-radius:20px;padding:30px;max-width:400px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3)}
h1{color:#333;margin:0 0 10px;font-size:24px;text-align:center}
.subtitle{text-align:center;color:#666;margin-bottom:25px;font-size:14px}
.btn{display:block;width:100%;padding:16px;margin:12px 0;font-size:17px;font-weight:600;border:none;border-radius:12px;cursor:pointer;color:#fff;transition:transform .2s}
.btn:active{transform:scale(.96)}
.btn1{background:#4CAF50}
.btn2{background:#2196F3}
.btn3{background:#FF9800}
.btn4{background:#f44336}
.info{background:#e3f2fd;padding:15px;border-radius:12px;margin-top:20px;font-size:14px;line-height:1.6;color:#0d47a1}
.success{background:#d4edda;color:#155724}
.warning{background:#fff3cd;color:#856404}
.error{background:#f8d7da;color:#721c24}
</style>
</head>
<body>
<div class="box">
<h1>üîß Test JavaScript iOS</h1>
<p class="subtitle">Versione compatibile PWA</p>

<button class="btn btn1" id="btn1">Test 1: Alert Base</button>
<button class="btn btn2" id="btn2">Test 2: DOM Update</button>
<button class="btn btn3" id="btn3">Test 3: Check Notifiche</button>
<button class="btn btn4" id="btn4">Test 4: Invia Notifica</button>

<div id="result" class="info">
Premi i pulsanti in ordine 1‚Üí2‚Üí3‚Üí4
</div>
</div>

<script>
(function() {
  'use strict';

  var resultDiv = document.getElementById('result');

  function updateResult(text, type) {
    resultDiv.innerHTML = text;
    resultDiv.className = 'info ' + (type || '');
  }

  // Test 1: Alert
  document.getElementById('btn1').addEventListener('click', function() {
    try {
      alert('‚úÖ JavaScript FUNZIONA!

Se vedi questo, tutto OK!');
      updateResult('‚úÖ <strong>Test 1 OK!</strong><br>Alert funziona. Prova Test 2.', 'success');
    } catch(e) {
      updateResult('‚ùå Errore Test 1: ' + e.message, 'error');
    }
  });

  // Test 2: DOM
  document.getElementById('btn2').addEventListener('click', function() {
    try {
      alert('Test 2: Modifico il DOM...');
      updateResult('‚úÖ <strong>Test 2 OK!</strong><br>DOM manipulation funziona. Prova Test 3.', 'success');
    } catch(e) {
      updateResult('‚ùå Errore Test 2: ' + e.message, 'error');
    }
  });

  // Test 3: Check Notification
  document.getElementById('btn3').addEventListener('click', function() {
    try {
      if (!window.Notification) {
        alert('‚ùå Notification API NON supportata!');
        updateResult('‚ùå Notification API non disponibile su questo dispositivo.', 'error');
        return;
      }

      var perm = Notification.permission;
      alert('‚úÖ Notification API supportata!

Permesso: ' + perm + '

(default = non chiesto
granted = ok
denied = negato)');
      updateResult('‚úÖ <strong>Test 3 OK!</strong><br>Notification API supportata.<br>Permesso: <strong>' + perm + '</strong><br><br>Prova Test 4.', 'success');
    } catch(e) {
      alert('‚ùå Errore: ' + e.message);
      updateResult('‚ùå Errore Test 3: ' + e.message, 'error');
    }
  });

  // Test 4: Request & Send
  document.getElementById('btn4').addEventListener('click', function() {
    try {
      if (!window.Notification) {
        alert('‚ùå Notification API non supportata!');
        return;
      }

      if (Notification.permission === 'granted') {
        sendNotif();
      } else if (Notification.permission !== 'denied') {
        alert('Sto per chiedere i permessi.

Premi OK poi CONSENTI.');
        Notification.requestPermission().then(function(p) {
          if (p === 'granted') {
            alert('‚úÖ Permessi concessi!

Invio notifica...

CHIUDI l'app per vederla!');
            sendNotif();
          } else {
            alert('‚ùå Permessi negati!');
            updateResult('‚ùå Permessi negati.', 'error');
          }
        });
      } else {
        alert('‚ùå Permessi gi√† negati!

Devi resettare il sito.');
        updateResult('‚ùå Permessi gi√† negati prima.', 'error');
      }
    } catch(e) {
      alert('‚ùå Errore: ' + e.message);
      updateResult('‚ùå Errore Test 4: ' + e.message, 'error');
    }
  });

  function sendNotif() {
    try {
      var n = new Notification('üéâ FUNZIONA!', {
        body: 'Se vedi questa notifica, tutto OK! ‚úÖ',
        tag: 'test',
        requireInteraction: false
      });

      alert('‚úÖ Notifica inviata!

‚ö†Ô∏è CHIUDI L'APP (Home)
per vedere la notifica!

Su iOS le notifiche
appaiono solo in background.');

      updateResult('‚úÖ <strong>Notifica inviata!</strong><br><br>‚ö†Ô∏è <strong>CHIUDI L'APP</strong> (premi Home) per vederla!<br><br>Su iOS le notifiche appaiono solo quando l'app √® in background.', 'warning');
    } catch(e) {
      alert('‚ùå Errore invio: ' + e.message);
      updateResult('‚ùå Errore invio notifica: ' + e.message, 'error');
    }
  }

  // Auto start message
  setTimeout(function() {
    alert('‚úÖ JavaScript caricato!

La pagina √® pronta.

Premi Test 1 per iniziare.');
  }, 500);

})();
</script>
</body>
</html>